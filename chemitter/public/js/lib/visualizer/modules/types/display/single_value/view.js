"use strict";define(["modules/default/defaultview","src/util/util","src/util/api","src/util/typerenderer","src/util/color","sprintf"],function(a,b,c,d,e,f){function g(){}function h(a){return i(a)||j(a)}function i(a){return a?a instanceof DataString||"string"===a.type:!1}function j(a){return a?a instanceof DataNumber||"number"===a.type:!1}return $.extend(!0,g.prototype,a,{init:function(){var a="<div></div>";this.module.getConfigurationCheckbox("append","yes")?this.dom=$(a).css({height:"100%",width:"100%","overflow-x":"hidden","overflow-y":"scroll"}):this.dom=$(a).css({display:"table","table-layout":"fixed",height:"100%",width:"100%"}),this.values={},this.module.getDomContent().html(this.dom),this.fillWithVal({type:"html",value:this.module.getConfiguration("defaultvalue","")}),this.resolveReady(),this._relsForLoading=["value"]},blank:{value:function(){if(this.module.getConfigurationCheckbox("append","yes"))for(var a=this.module.getConfiguration("maxEntries"),b=this.dom.children(),c=b.length-a,d=0;c>d;d++)b[d].remove();else this.dom.empty()},color:function(){this.module.getDomContent().css("background-color","#FFF")}},update:{color:function(a){this.module.getDomContent().css("background-color",a.get())},value:function(a,b){(a instanceof DataNumber||"number"===a.type)&&(this._lastValueNumber=!0),this.values[b]=a,this._lastValue=a,this.renderAll()}},onResize:function(){this.renderAll(),this.refresh()},renderAll:function(){var a=this._lastValue;if(a){var c=this,d=this.module.getConfiguration("sprintf"),e=b.evalOptions(this.module.getConfiguration("rendererOptions"))||{},g=this.module.getConfiguration("forceType");if(g&&(e.forceType=g),d)if(Object.keys(e).length>0){var h=[];for(var i in c.values)h.push(this.renderVal(c.values[i],e));Promise.all(h).then(function(a){var b=[d].concat(a);c.fillWithVal(f.sprintf.apply(null,b))})}else try{var j=[d];for(var i in c.values)j.push(c.values[i]);a=f.sprintf.apply(this,j),c.fillWithVal(a,e)}catch(b){c.fillWithVal(a,e)}else c.fillWithVal(a,e)}},_scrollDown:function(){var a=this.dom[0].scrollHeight;this.dom.scrollTop(a)},renderVal:function(a,b){var c=$("<span>");return d.render(c,a,b).then(function(){return c.html()}).catch(function(){return"[failed]"})},fillWithVal:function(a,b){var c,f=this,g=this.module.getConfiguration("valign"),i=this.module.getConfiguration("align"),j=this.module.getConfiguration("fontcolor"),k=this.module.getConfiguration("fontsize"),l=this.module.getConfiguration("font"),m=this.module.getConfigurationCheckbox("preformatted","pre"),n=this.module.getConfigurationCheckbox("preformatted","selectable");j&&(j=e.getColor(j)),this.module.getConfigurationCheckbox("append","yes")?(c=$("<div>").css({fontFamily:l||"Arial",fontSize:k||"10pt",color:j||"#000000","vertical-align":g||"top",textAlign:i||"center",width:"100%","white-space":m?"pre":"normal","word-wrap":"break-word","user-select":n?"text":"none"}),this.dom.append(c)):(c=$("<div />").css({fontFamily:l||"Arial",fontSize:k||"10pt",color:j||"#000000",display:"table-cell","vertical-align":g||"top",textAlign:i||"center",width:"100%",height:"100%","white-space":m?"pre":"normal","word-wrap":"break-word","user-select":n?"text":"none"}),this.dom.html(c),this.module.getConfigurationCheckbox("editable","yes")&&h(this._lastValue)&&(c.attr("contenteditable",!0),c.on("input",function(a){var b=a.target.innerHTML.replace(/<[^>]*>/g,"");f._lastValueNumber&&(b=+b),f._lastValue.setValue(b,!0),f.module.model.dataTriggerChange(f._lastValue)}),c.on("keyup",function(a){27===a.keyCode&&c.blur()}),c.on("click",function(){if(b.forceType){var e=Object.assign({},b);delete e.forceType,d.render(c,a,e).then(function(){f._scrollDown(),c.focus()})}}),c.on("blur",function(){d.render(c,a,b).then(function(){f._scrollDown()})}))),this._scrollDown(),d.render(c,a,b).then(function(){f._scrollDown()})}}),g});